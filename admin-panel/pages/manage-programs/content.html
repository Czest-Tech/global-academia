<?php


  $jobs = $db->get(T_PROGRAM);


?>
<div class="page-header d-md-flex justify-content-between">
    <div>
        <h3>Manage Programs</h3>
        <nav aria-label="breadcrumb" class="d-flex align-items-start">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href=index.html>Home</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="#">Programs</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page"> Manage Programs</li>
            </ol>
        </nav>
    </div>     
</div>

    <!-- Vertical Layout -->
    <div class="row">
        
        <div class="col-lg-12 col-md-12">
            <div class="card">
                <div class="card-body">
                    <form method="post" id="export_excel_form">
                          <div class="row">
                                <div class="col-md-6">Export Data</div>
                                <div class="col-md-4">
                                  <select name="file_type" class="form-control input-sm">
                                    <option value="Xls">Xls</option>
                                    <option value="Csv">Csv</option>
                                  </select>
                                </div>
                                <div class="col-md-2">
                                  <input type="submit" id="export" name="export" class="btn btn-primary btn-sm" value="Export" />
                                  <input type="hidden" name="hash" value="<?php echo CreateMainSession(); ?>"/>

                                </div>
                          </div>
                    </form>
                    <form method="post" id="import_excel_form" enctype="multipart/form-data">   
                        <span>Select Excel File</span>
                        <span><input type="file" name="import_excel" /></span>
                         <input type="hidden" name="hash_id" value="<?php echo CreateSession()?>">
                        <input type="hidden" name="user_id" value="<?php echo $kd->user->id?>">
                        <input type="hidden" name="hash" value="<?php echo CreateMainSession(); ?>"/>

                        <span><input type="submit" name="import" id="import" class="btn btn-primary" value="Import" /></span>
                    </form>
                    <div class="pull-right">
                        <a href="<?php echo LoadAdminLinkSettings('add-program'); ?>" ><button class="btn btn-primary"> Add Program</button></a>
                    </div>
                  
                    <div class="clearfix"></div>
                    <div class="table-responsive">
                        <table id="job-manage" class="table table-lg">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>University</th>
                                    <th>Department</th>
                                    <th>Degree</th>
                                    <th>Duration</th>
                                    <th class="text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php

                                    foreach ($jobs as $key => $job){
                                                                   
                                        echo LoadAdminPage('manage-programs/list', array('JOB_DATA' => $job));                                       
                                    }
                                ?>
                            </tbody>
                        </table>
                    </div>
                   
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <!-- #END# Vertical Layout -->
        <div id="featured-modal" class="modal fade" role="dialog" data-id="" data-user-id="">
            <div class="modal-dialog">
                <div class="modal-content modal-col-red">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add this Job To Featured Jobs</h4>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to continue? this action will add a job to appear in the site featured jobs</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-link waves-effect add_to_featured-button" data-dismiss="modal" data-type="add">Add</button>
                        <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                    </div>
                </div>
            </div>
        </div>
    
    <script>
        $(document).ready(function (){
            $('#job-manage').DataTable({
                "scrollY": "400px",
                "scrollCollapse": true
            });
        });
        $(function() {
           "use strict";
            $('.delete-content').on('click', function(event) {
                event.preventDefault();
                $()
                $('#delete-modal').attr('data-id', $(this).attr('data-id')).modal('show');
            });

            $('.add_to_featured').on('click', function(event) {
                event.preventDefault();
                $('#featured-modal').attr('data-user-id', $(this).attr('data-user-id'));
                $('#featured-modal').attr('data-id', $(this).attr('data-id')).modal('show');
            });
        });
         $(function(){
              $('#import_excel_form').on('submit', function(event){
                event.preventDefault();
                $.ajax({
                  url: '{{LINK aj/application/import_programs}}',
                  method:"POST",
                  data:new FormData(this),
                  contentType:false,
                  cache:false,
                  processData:false,
                  beforeSend:function(){
                    $('#import').attr('disabled', 'disabled');
                    $('#import').val('Importing...');
                  },
                  success:function(data)
                  {
                    if(data.status == 200){
                        toastr.options = {
                                timeOut: 2000,
                                progressBar: true,
                                showMethod: "slideDown",
                                hideMethod: "slideUp",
                                showDuration: 200,
                                hideDuration: 200
                              };
                          toastr.success('File Imported!');

                        $('#import_excel_form')[0].reset();
                        $('#import').attr('disabled', false);
                        $('#import').val('Import');
                    }
                  }
                });
              });
                $('#export_excel_form').on('submit', function(event){
                event.preventDefault();
                $.ajax({
                  url: '{{LINK aj/application/export_program}}',
                  method:"POST",
                  data:new FormData(this),
                  contentType:false,
                  cache:false,
                  processData:false,
                  beforeSend:function(){
                    $('#export').attr('disabled', 'disabled');
                    $('#export').val('Generating file...');
                  },
                  success:function(data)
                  {
                    if(data.status == 200){
                        toastr.options = {
                                timeOut: 2000,
                                progressBar: true,
                                showMethod: "slideDown",
                                hideMethod: "slideUp",
                                showDuration: 200,
                                hideDuration: 200
                              };
                          toastr.success('File Imported!');

                        $('#export_excel_form')[0].reset();
                        $('#export').attr('disabled', false);
                        $('#export').val('export');
                        window.location = data.download_url;
                    }
                  }
                });
              });
            });
    </script>

