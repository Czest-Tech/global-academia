<div class="messages">
  <!-- <div class="message_list">
        <p>All Messages</p>
        <div class="message_links" id="message_links">
        </div>
    </div> -->
  <div class="message_pad">
    <div class="message_pad_messages" id="message_pad">
      <!-- Messages Rendered From JS -->

    </div>

    <!-- <div class="reply_pad">
      <div class="get_image">
        <input type="file" id="message_upload" hidden>
        <label for="message_upload" class="message_upload pointer">
          <i class="fas fa-upload"></i>
        </label>
      </div>
      <div class="enter_message">
        <input type="text">
        <i class="fas fa-paper-plane"></i>
      </div>
    </div> -->

    <form method="post" class="reply_pad" id="send-message">
      <input type="file" name="file" id="input-file" hidden>
      <input type="hidden" name="name" id="input-names" value="{{ME first_name}} {{ME last_name}}" />
      <input type="hidden" name="email" id="input-email" value="{{ME email}}" />
      <input type="hidden" name="user_id" value="{{ME id}}" />
      <div class="get_image">
        <label for="input-file" class="message_upload pointer">
          <i class="fas fa-upload"></i>
        </label>
      </div>
      <div class="enter_message">
        <input placeholder="Send message to admin.." name="message" id="input-message" />
        <button type="submit" id="send-message-btn">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>


      <!-- <div class="reply_pad">
          <label for="input-file">
              <i class="fas fa-upload"></i>
          </label>
          <input placeholder="Send message to admin.." name="message" id="input-message" />
          <button type="submit" id="send-message-btn">
              Send
          </button>
      </div> -->
  </form>
  </div>
</div>

<script>
  let form2 = $('form.reply_pad');
  $.get('{{LINK aj}}' + "/user_dashboard/get_user_messages?hash=" + $('.main_session').val(), {}, (data => {
    if (data.status === 200) {
      render_messages(data.chats)
    }
  }));
  function render_messages(data) {
    data.forEach(element => {
      const sender = `
        <div class="right_message message_row">
            <div class="bubble_text_right">
                <p class="font2 bold300">${element.message}}</p>
                <p class="font1 bold400 bubble_text_arrival">${element.created_at}</p>
            </div>
        </div>
    
    `
      const reciever = `
        <div class="left_message message_row">
            <div class="left_bubble">
                <img src="https://www.globalacademia.com/wp-content/uploads/2017/11/global-academia-logo.jpg" alt="message_row_image" class="message_row_image"/>
                <div class="bubble_text">
                    <p class="font2 bold600 dark_color">Global Academia</p>
                    <p class="font2 bold300">${element.message}</p>
                    <p class="font1 bold400 bubble_text_arrival">${element.created_at}</p>
                </div>
            </div>
        </div>
    `
      let message = ""
      const chat = Math.ceil(Math.random() * 2000)
      if (element.from === "admin") message = reciever
      else message = sender

      document.getElementById("message_pad").innerHTML += message

      const container = document.getElementById("message_pad")
      container.scrollTop = container.scrollHeight
    });

    $(function () { 

        form2.ajaxForm({
            url: '{{LINK aj/front_end_api/send_applicant_message}}?hash=' + $('.main_session').val(),
            dataType: 'json',
            beforeSend: function () {
                form2.find('button').text("{{LANG ....}}");
            },
            success: function (data) {
                if (data.status == 200) {
                    renderMessages(data.chats)
                    document.getElementById("send-message-btn").innerHTML = "Send"
                    document.getElementById("input-message").value = ""
                    document.getElementById("input-file").value = ""
                    document.getElementById("file-container").innerHTML = ""
                }
                else {
                    $('.results').html(data.message);
                    document.getElementById("send-message-btn").innerHTML = "Failed"
                    setTimeout(function () { document.getElementById("send-message-btn").innerHTML = "Send" }, 3000);
                }
            }
        });
    });
  }



</script>